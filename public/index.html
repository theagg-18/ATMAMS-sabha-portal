<!-- Version: 2.0.0 -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sabha Member Portal</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-800">

    <div id="app-container" class="min-h-screen flex flex-col items-center justify-center p-4">
        
        <div id="loading-screen" class="fixed inset-0 bg-white bg-opacity-75 flex flex-col items-center justify-center z-50">
            <div class="spinner"></div>
            <p class="mt-4 text-lg font-medium text-gray-600">Loading Portal...</p>
        </div>

        <div id="auth-screen" class="w-full max-w-lg hidden">
            <div class="bg-white p-8 rounded-xl shadow-lg">
                <h1 class="text-3xl font-bold text-center text-blue-600 mb-2">Sabha Digital Portal</h1>
                <p class="text-center text-gray-500 mb-6">Manage your membership and family details.</p>
                <div id="auth-tabs" class="flex border-b mb-6"><button id="show-login-btn" class="flex-1 py-2 font-semibold border-b-2 border-blue-600 text-blue-600">Login</button><button id="show-register-btn" class="flex-1 py-2 font-semibold text-gray-400">Register</button></div>
                <form id="login-form" class=""><div class="mb-4"><label for="login-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label><input type="email" id="login-email" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="your.email@example.com"></div><div class="mb-4"><label for="login-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label><input type="password" id="login-password" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="••••••••"></div><div class="text-right mb-6"><a href="#" id="forgot-password-link" class="text-sm text-blue-600 hover:underline">Forgot Password?</a></div><button type="submit" class="w-full bg-blue-600 text-white py-2.5 rounded-md font-semibold hover:bg-blue-700 transition duration-200">Sign In</button></form>
                <form id="forgot-password-form" class="hidden"><h3 class="text-xl font-semibold text-center mb-4">Reset Your Password</h3><p class="text-center text-gray-600 mb-6">Enter your email address and we will send you a link to reset your password.</p><div class="mb-6"><label for="reset-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label><input type="email" id="reset-email" required class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="your.email@example.com"></div><button type="submit" class="w-full bg-blue-600 text-white py-2.5 rounded-md font-semibold hover:bg-blue-700">Send Reset Link</button><button type="button" id="back-to-login-btn" class="w-full mt-3 text-sm text-blue-600 hover:underline">Back to Login</button></form>
                <div id="register-container" class="hidden">
                    <div id="step-full-registration" class="form-step active">
                        <form id="register-form" class="overflow-y-auto" style="max-height: 70vh;">
                            <p class="text-sm text-center bg-blue-50 border border-blue-200 text-blue-800 p-3 rounded-md mb-6">Register your family and choose one adult to be the primary account holder for the online portal.</p>
                            
                            <div class="border-b-2 border-dashed border-gray-300 pb-4 mb-4">
                                <div class="flex justify-between items-center mb-2"><h3 class="text-lg font-semibold text-gray-800">Your Details (Applicant)</h3><label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="primaryAccountHolder" value="Self" checked class="h-4 w-4 text-blue-600"><span class="text-sm font-medium">Set as Account Holder</span></label></div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div><label class="block text-sm font-medium">Full Name</label><input type="text" name="Self_fullName" required class="w-full px-3 py-2 border border-gray-300 rounded-md"></div>
                                    <div><label class="block text-sm font-medium">Date of Birth</label><input type="date" name="Self_dob" required class="w-full px-3 py-2 border border-gray-300 rounded-md"></div>
                                    <div><label class="block text-sm font-medium">Gender</label><select name="Self_gender" required class="w-full px-3 py-2 border border-gray-300 rounded-md"><option value="">Select</option><option value="Male">Male</option><option value="Female">Female</option></select></div>
                                    <div><label class="block text-sm font-medium">Aadhaar</label><input type="number" name="Self_aadhaar" required class="w-full px-3 py-2 border border-gray-300 rounded-md"></div>
                                </div>
                                <div id="account-fields-Self" class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"></div>
                            </div>
                            
                            <div class="border-b-2 border-dashed border-gray-300 pb-4 mb-4">
                                <div class="flex justify-between items-center mb-2"><h3 class="text-lg font-semibold text-gray-800">Spouse Details</h3><div class="flex items-center"><label class="flex items-center space-x-2 cursor-pointer mr-4"><input type="radio" name="primaryAccountHolder" value="Spouse" class="h-4 w-4 text-blue-600"><span class="text-sm font-medium">Account Holder</span></label><input type="checkbox" id="add-spouse-toggle" class="rounded text-blue-600 align-middle"><label for="add-spouse-toggle" class="text-sm font-medium text-gray-600 align-middle ml-2">Add Spouse</label></div></div>
                                <div id="spouse-details" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                                <div id="account-fields-Spouse" class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4 hidden"></div>
                            </div>
                            
                             <div class="border-b-2 border-dashed border-gray-300 pb-4 mb-4">
                                <h3 class="text-lg font-semibold text-gray-800 mb-2">Father's Details</h3>
                                <div><label class="block text-sm font-medium text-gray-700 mb-1">Father's Full Name</label><input type="text" name="fatherName" required class="w-full px-3 py-2 border border-gray-300 rounded-md"></div>
                                <div class="mt-3"><label class="flex items-center space-x-2 cursor-pointer"><input type="checkbox" id="link-father-toggle" class="rounded text-blue-600"><span class="text-sm font-medium text-gray-600">Link to a registered member?</span></label></div>
                                <div id="father-link-details" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                                    <div><label class="block text-sm">Sabha ID</label><input type="text" name="fatherSabhaId" class="w-full px-3 py-2 border border-gray-300 rounded-md"></div>
                                    <div><label class="block text-sm">Aadhaar</label><input type="number" name="fatherAadhaar" class="w-full px-3 py-2 border border-gray-300 rounded-md"></div>
                                </div>
                            </div>

                            <div class="border-b-2 border-dashed border-gray-300 pb-4 mb-4">
                                <h3 class="text-lg font-semibold text-gray-800 mb-2">Mother's Details</h3>
                                <div><label class="block text-sm font-medium text-gray-700 mb-1">Mother's Full Name</label><input type="text" name="motherName" required class="w-full px-3 py-2 border border-gray-300 rounded-md"></div>
                                <div class="mt-3"><label class="flex items-center space-x-2 cursor-pointer"><input type="checkbox" id="link-mother-toggle" class="rounded text-blue-600"><span class="text-sm font-medium text-gray-600">Link to a registered member?</span></label></div>
                                <div id="mother-link-details" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                                    <div><label class="block text-sm">Sabha ID</label><input type="text" name="motherSabhaId" class="w-full px-3 py-2 border border-gray-300 rounded-md"></div>
                                    <div><label class="block text-sm">Aadhaar</label><input type="number" name="motherAadhaar" class="w-full px-3 py-2 border border-gray-300 rounded-md"></div>
                                </div>
                            </div>
                            
                            <button type="submit" class="w-full bg-blue-600 text-white py-2.5 rounded-md font-semibold hover:bg-blue-700 transition duration-200 mt-4">Register Family</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="app-screen" class="w-full max-w-6xl hidden">
            <header class="bg-white p-4 rounded-xl shadow-lg mb-6 flex justify-between items-center"><h1 class="text-2xl font-bold text-blue-600">Sabha Dashboard</h1><div class="flex items-center gap-4"><p id="user-welcome" class="text-gray-600"></p><button id="logout-btn" class="bg-red-500 text-white px-4 py-2 rounded-md font-semibold hover:bg-red-600 transition">Logout</button></div></header>
            <main class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-1 space-y-6">
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h2 class="text-xl font-bold mb-4">Digital Sabha ID</h2>
                        <div id="digital-id-card" class="bg-white border-2 border-gray-200 rounded-lg overflow-hidden shadow-lg"><div class="bg-blue-600 p-3 flex items-center gap-3"><div class="w-12 h-12 bg-white rounded-full flex items-center justify-center"><svg class="w-8 h-8 text-blue-600" fill="currentColor" viewBox="0 0 20 20"><path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"></path></svg></div><h3 class="font-bold text-white text-xl">SABHA MEMBERSHIP</h3></div><div class="p-4 flex gap-4 items-center"><div id="id-card-photo-container" class="w-24 h-24 bg-gray-200 rounded-md flex-shrink-0"><img id="id-card-photo" src="" alt="Profile Photo" class="w-full h-full object-cover rounded-md hidden"></div><div class="flex-grow flex flex-col"><p id="id-card-name" class="font-bold text-lg text-gray-800"></p><p class="text-sm text-gray-500">ID: <span id="id-card-sabha-id" class="font-mono"></span></p><p class="text-sm text-gray-500">DOB: <span id="id-card-dob"></span></p></div><div id="id-card-qrcode" class="w-16 h-16 flex-shrink-0"></div></div></div>
                        <button id="download-id-btn" class="mt-4 w-full bg-gray-700 text-white py-2 rounded-md font-semibold hover:bg-gray-800 transition">Download ID Card</button>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h2 class="text-xl font-bold mb-4">Profile Photo</h2>
                        <div id="photo-preview-container" class="w-32 h-32 bg-gray-200 rounded-lg mx-auto mb-4 flex items-center justify-center"><img id="photo-preview" src="" alt="Photo Preview" class="w-full h-full object-cover rounded-lg hidden"><span id="photo-placeholder-text" class="text-xs text-gray-500 text-center">Photo Preview</span></div>
                        <label for="photo-upload-input" class="w-full text-center block bg-blue-100 text-blue-800 py-2 rounded-md font-semibold cursor-pointer hover:bg-blue-200">Choose File</label><input type="file" id="photo-upload-input" class="hidden" accept="image/png, image/jpeg"><button id="upload-photo-btn" class="mt-2 w-full bg-green-600 text-white py-2 rounded-md font-semibold hover:bg-green-700 hidden">Upload Photo</button>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h2 class="text-xl font-bold mb-4">Security</h2>
                        <form id="change-password-form"><div class="mb-4"><label for="current-password" class="block text-sm font-medium text-gray-700 mb-1">Current Password</label><input type="password" id="current-password" required class="w-full px-3 py-2 border border-gray-300 rounded-md"></div><div class="mb-4"><label for="new-password" class="block text-sm font-medium text-gray-700 mb-1">New Password</label><input type="password" id="new-password" required class="w-full px-3 py-2 border border-gray-300 rounded-md"></div><div class="mb-6"><label for="retype-new-password" class="block text-sm font-medium text-gray-700 mb-1">Retype New Password</label><input type="password" id="retype-new-password" required class="w-full px-3 py-2 border border-gray-300 rounded-md"></div><button type="submit" class="w-full bg-green-600 text-white py-2.5 rounded-md font-semibold hover:bg-green-700">Change Password</button></form>
                    </div>
                </div>
                <div class="lg:col-span-2"><div class="bg-white p-6 rounded-xl shadow-lg"><div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold">My Family</h2><button id="add-family-member-btn" class="bg-green-500 text-white px-4 py-2 rounded-md font-semibold hover:bg-green-600 text-sm flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-circle-fill" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z"/></svg> Add Member</button></div><div id="family-tree-container" class="space-y-4"><p class="text-gray-500">Your registered family members will be listed here.</p></div></div></div>
            </main>
        </div>
        <div id="add-member-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden"><div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg"><div class="flex justify-between items-center mb-4"><h3 class="text-xl font-bold">Link or Add Family Member</h3><button id="close-add-member-modal-btn" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button></div><form id="add-member-form"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Relation</label><select name="newMemberRelation" id="new-member-relation" required class="w-full px-3 py-2 border border-gray-300 rounded-md"><option value="">Select Relation</option><option value="Spouse">Spouse</option><option value="Child">Child</option><option value="Father">Father</option><option value="Mother">Mother</option><option value="Brother">Brother</option><option value="Sister">Sister</option></select></div></div><div id="add-member-fields-container" class="mt-4"></div><div class="mt-6 flex justify-end gap-4"><button type="button" id="cancel-add-member-btn" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-md font-semibold">Cancel</button><button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md font-semibold">Save Member</button></div></form></div></div>
    </div>
    <script type="module" src="js/main.js"></script>
</body>
</html>

